#include <climits>
#include <iostream>
#include <map>
#include <set>
#include <string>
#include <vector>

#include <catch2/catch_test_macros.hpp>

using namespace std;

const vector<string> inputTestdata = {
    "...........",
    ".....###.#.",
    ".###.##..#.",
    "..#.#...#..",
    "....#.#....",
    ".##..S####.",
    ".##..#...#.",
    ".......##..",
    ".##.#.####.",
    ".##..##.##.",
    "..........."
};

const vector<string> inputData = {
    "...................................................................................................................................",
    ".##.....#........#........#...........#......#....##.....##....................#...#.......#.....................#......#.#........",
    "...........................#.......#...#.#...#....#...........................#................##.......#....................#.#...",
    "..............#..............##...#.....#.#...#..#.......#...................................#..#......#.......#....#...........##.",
    "..........##...#..#......#...#.#..........................................#....................#.....................#.....#.......",
    "..#............##.....................##.........#..............................#.............##.........##..................#.....",
    "..............#.#..............................#...............................#....#...#..#.......................#...##..........",
    ".....................#...#....#.......#.............#.#...........##...................#.#...........##......#.#......#.....#.#....",
    ".....#.......#..........#...##.#.....#.......#.#.....#.......................#....#..#....................#.#.#....#.......#.......",
    "..#............#.#..........#.....#.....#.......#..............................................#.................#.................",
    "......#........##..........#........#............##......................................................#.........#...............",
    "......#...#.....#....##.................#.......................#..#..............................#.......#..............#.....#...",
    ".......#..#.......#..........#.............................#.##.........................................#...#.........#............",
    "....................#.............#.#..............................#......#...........##...##..............#..#.....#..............",
    "........#.........#...................#................##..#...#...#.......#.....................#...#........#.#.......#..........",
    ".......................#..#.....##...........................#.#.....................#............#.#.............#.#...#..........",
    "..#....#....#...............#........#.........................#......#...........................#.##..#.###..#....##.......#.....",
    "...........#..##..............#...##............................#..#.....................#............#............................",
    "...##.......#........#.#.....#.........#.#.........#..............##....................#.##.....#............#.................#..",
    "...#......#....#............#............#...............#.#......#.............#.............#........#.#.##.........#....#....#..",
    ".#...###.#....#..................#...#.................#......#........#...#.....#.......#...................#..........##.........",
    "...#..........#........#.......#.................#......#...............#...................#..................#...#....#..........",
    "...........#....#..................#...#.......#..........#....#......#......#...#...........#..........................#..#.......",
    "....###...............#......#........#...............#...##...#...............##..............#....#..........#..#....#...........",
    ".............##......#.#............#........#....................#.#.........#..............#................#.#..............#...",
    ".###....#...............#.........#.#...............................#...#......###....................#.##.........#...............",
    "......#..............#.........#.............#..#..#.......####.....................................#..#...........................",
    "....#...#........#..........................#........#....#.#..#.............#...#...................#.............................",
    "......#...#.................................#.....#...........#..................................................#....#.#..........",
    "..........#.....#.................................##..#........#..................##.......................#.......................",
    "..#..#.##.#.#..............#..#.................#..................#........#.........#..............#....................#.##.....",
    ".........#.......#.....#.#...............#...#....#..#.............#...#...............................#...#.##...#.....#......#...",
    "..#..#..........#.......................#............#...#............#............#..#...............#............................",
    ".#..................##.#..............#..................#.....#..............#....#...#..##............................#...#...#..",
    ".#.....#..#.........................#....#........#........#........#..##........#..........#.#.........##..#..........#........#..",
    "...................#...##................#..........#.......#...............##....................................#...#............",
    "................#...#.................#.....#..............#...............#......#...#....##...................#.....#.....#......",
    "....................##............................#..##..##..##...........#.......#.#.#..#....#...................#................",
    "..#........#.#..#....#..............#............................................##.................................#..............",
    "..........#.......#...............................#.......#..#....#...#.......###.......#..........#.........#........#........#...",
    "........................................#.............#.##........................#...............#..............#.................",
    "...#...........................#.................#.......#..#.....#...#.........................#...#..........#.............#.....",
    "..................................#...#..............#......#..##..#..#........#..#.#..........##....##..................#....#....",
    "..#..........#....................#......#....#.........##....#..........#......##...#.....#........##...................#.........",
    "..........#..............#.............................#...............................#.......................................#...",
    ".............#..........#.......#...#.#..#..#..#...#.......#..#..........#..#......................................................",
    "...#.....#.................##..##....#.#..#...................#......#......#...........#..#....#...................#.......###....",
    "........#....................#....#...........#.............#...............#...........#...#.........................##..#.#......",
    ".....................#...........#..#..#....#..............#..........#..#.........#..##..........#............................#...",
    "...#......#.........................#.......#.......#...#.........#........................#.#.........#......#............#.......",
    "....................#.#..#..................................................#......#............#.##........##..............#......",
    ".......#...........#...#.#..#....#.#.......................##.................................#................................#...",
    ".......#............#...#......#..#.#................#................................#...##....#..#...........#.............#.....",
    ".........................#....................#.#..##..#..............#...#....#...##..............................................",
    ".........................##..............#........#.#...........#........#.............#...........................#..........#....",
    ".#....#..........................#......#..#...#...........#.......#..........................................#....................",
    "....................#........#....#..#...........#.....................##.##.....#...#..................#..........#...............",
    ".....................#....................#.#..................##.....#............#.......##..#...........#.......................",
    ".....................#..#........#...#.#..................#....#.....................................#..........##....#............",
    "...........................#.#....#...............#...............#........#........#...#..........#..........#....................",
    ".................###......#.......#....................#.............#............#....................#.....#.......##............",
    ".........##......#.....................#.....#..........#.....................#......#..........#.....................#............",
    "..................#..#........##..###.....................#..........#......#...#......#.#......#......#.............#....#........",
    ".........#....#.#.............#....#........#.....#..........#...........................#.......#....#...#........................",
    "...........#.................................................#....................#.......#...........#...#.......#................",
    ".................................................................S.................................................................",
    "..................#...............#..........#..........####.............##......#.#...#.......###........#..................#.....",
    ".......................#...#..##...................##..........................#...##..........##........#...##....................",
    "............#................#.............................#................#......#..........##...................................",
    ".............#....#.....##...............#....#..##...#.....#............................##..............#.........................",
    ".............###.....#..........#.....................................#....#.#.........#................................#..........",
    "..............#..........................................#........##...#.#.#...............#..........#............##............#.",
    "............#....#............#.........#...........#.............#............................#..##..#............................",
    "...#...................#.........#...#............#..#........................#.#.#..#..#.............#.....#......................",
    ".................#........................#.........#..........#..#............#.#.....#...........#....#....#.................#...",
    ".....#.................#....#........#.#......#............##.........#.#.........##...........#..#............#..#..............#.",
    ".....................................................#..................................#..............#..#.......#..............#.",
    ".......................................#...........#.........................................#...........#.....#..............#....",
    "...#.#..#..........#...#.##.#..........................................#...............#.#.......#.......................#...#..#..",
    "....##.##.#.........#...#......#.#.#..........................................#.........#......##...#......#................#......",
    ".......................#...#......#....#...#...#.......#......................#...........................#.#......................",
    ".......#..#.................#...#...#...........#........#.........#......#.#.#...##.............#....................#..#.........",
    "........................................................#.............................#..........#...#.................#...........",
    "............###......................#.................................#..................................##...............#.......",
    "..........................................#.#........................#......#.#..#..................#..#......................#.#..",
    ".........##........................#...#....#.....#.#......#...................#.............#.........#............#.#.#..#.......",
    "......#......................##...........#....#.##.....#......#..#...#..#.........#..#...#....#.......................##....#.....",
    "..............................#......#........#...#............#.........#.##..........................#.........#..........#.#....",
    "...##...#....................#.....#................................##.....#.......................#...........#..#....#...........",
    ".......#....#...#...................#.#...........#......#..........#......#...........#.............#....................#......#.",
    ".................................#......#.#...............#.......#..........#.#..#.#.............#..........###....#..#...........",
    "..............#..#....#..............................................#......#.........#...........................#................",
    ".#..........#....#....#..........#..#.........................#...#.....#.....................##...#...............#.....#.........",
    ".......#.......#.#.......................#...............#.........#.......................##.....................#......#...#.....",
    ".....................................#....#.........#.....#...................##............#...............................#.#....",
    "........#...#...#.....................................##...............#.......#...#.......#...............#..#.........#.....#....",
    "....#............#........#............................#......#.....#.#..#..............................#...#..#...#...............",
    ".....#..................#..............#............#.............#.#.#.#......#......#................#.....#.....................",
    ".......#...........#.........................#...............##....#..##.......#........#.................#..............#...#.....",
    "..#..#.......#.#......#......#...........#.#..................#...#..##..#...........#........................###..........#.......",
    "........#......................#........#........##.#......................##..#...#............................#...........#......",
    "...............#.....#........#.#...................#.......#..............#............#........................#.....#..#..#.....",
    "........##...#....#....#.......................................#.........#..##......................##..#......#...................",
    "..#..........#.....#....#.#..#.....................................#...#.#..#..#.#.#..#............#.............##................",
    "..................#......#...................##........#.......##...#.............#............................##.........#........",
    "......................#........#.#.#...........#.......#.#.....................................#.............#....##.......#....#..",
    ".............#.....#...........#..#.............##...#..#.............................................#...........#.#...#.....#....",
    "..........................#..#..................#.......#..#.........#......#..#..................#....#..........#.#...#..........",
    ".....#.........##.....#.......#.......#.........#..#.##...#...................#..........................#......#.#................",
    "....#.#.................#...........#.......................................#.....#.........#.............#..................#.....",
    "....#.....#.................#.#....#...#...............#.....#.............#.............#..................#.......#.....#....#...",
    ".....#..........................#..#.........................#........#....#..#.................##...............................#.",
    ".......#..................................................#...............................#......#.............#....#..............",
    "..#...#......##......................#....................#.........#........................#.......#....#.......#...#....#.......",
    "........#..........#....................#....#.............##...........##...........#..........................................#..",
    ".###................#..........#......................#.......#.......#.............#..............................#......#....#...",
    "...#......#...#.#........#.....#.........##.........................#.#....................#......................#.#...........##.",
    "..........#.........................#....#.....##............#.....................#...............................................",
    "..#...........##...............................#.#.................#..............#.............#..#................#..#...........",
    "......#............#..#...........#.............#.........#....#..#.............#....#............#...........#.....#..............",
    "...##..#..........#...#..................#.....#...............#.....#.................................###..............#..........",
    "..............#.#.................#...........#................#....#...........#.........#.........#...#..............#...........",
    "................#.#...#.......#.........#.#..#...............................#.#....................#......#.......#.....#.........",
    "....................#...#....#...#............#....#............................#.#.#......##.#...##......#.#.#.....#..........#...",
    ".........#..............#..#......#............#.................................#..........#......#.........#...........#..#..##..",
    "...#.#....#.....##..................#.##..##....#.......#.......#.............................................................#....",
    ".....#..#.......#...................#.........................................#...#.................#......................#....#..",
    "............................................................................#......................................................",
    "......................#.....#......#...#..........#........#..............................#.#..#..........#........##..............",
    "..................##...#......#.#.#...#..##.........#......#.................##.....#...#.......#...#....#..#....#......##.........",
    "..................................................................................................................................."
};

class StepCounter {
public:
    StepCounter(const vector<string>& _input)
        : input(_input)
        , rows(_input.size())
        , cols(_input[0].size())
    {
        cout << "Size of Input: " << input.size() << endl;

        // Find S and Rocks
        for (int r = 0; r < rows; ++r) {
            for (int c = 0; c < cols; ++c) {
                if ('S' == input[r][c]) {
                    S = { r, c };
                }
            }
        }
    }

    long getSteps(long steps)
    {
        map<long, set<pair<long, long>>> stepmap;
        stepmap[0].insert(S);
        for (long s = 1; s <= steps; ++s) {
            for (auto sm : stepmap[s - 1]) {
                // Step into surrounding
                if (sm.first > 0 && '#' != input[sm.first - 1][sm.second])
                    stepmap[s].insert({ sm.first - 1, sm.second });
                if (sm.first < rows - 1 && '#' != input[sm.first + 1][sm.second])
                    stepmap[s].insert({ sm.first + 1, sm.second });
                if (sm.second > 0 && '#' != input[sm.first][sm.second - 1])
                    stepmap[s].insert({ sm.first, sm.second - 1 });
                if (sm.second < cols - 1 && '#' != input[sm.first][sm.second + 1])
                    stepmap[s].insert({ sm.first, sm.second + 1 });
            }
        }

        return stepmap[steps].size();
    }

    long getResultA(long steps)
    {
        long resultA = getSteps(steps);

        cout << "resultA: " << resultA << endl;
        return resultA;
    }
    long getResultB()
    {
        long resultB = 0;

        cout << "resultB: " << resultB << endl;
        return resultB;
    }

private:
    const vector<string> input;

    size_t rows, cols;
    pair<long, long> S;
};

TEST_CASE("Testdata")
{
    StepCounter StepCounterData(inputTestdata);
    REQUIRE(16 == StepCounterData.getResultA(6));
    REQUIRE(0 == StepCounterData.getResultB());
}

TEST_CASE("StepCounter")
{
    StepCounter StepCounterData(inputData);
    REQUIRE(3830 == StepCounterData.getResultA(64));
    REQUIRE(0 == StepCounterData.getResultB());
}